# Анализ деятельости Россельхознадзора по ограничению распространения карантинных растений по данным о карантинных зонах
Программа приводит данные из открытых источников к формату, удобному для анализа и отображает их на карте и в виде столбиковой диаграммы.

## Подготовка исходных данных
В качестве исходных данных программа использует:

1. С сайта [Россельхознадзора](https://fsvps.gov.ru/opendata) (раздел *Открытые данные*):
    * Список растений-карантинных объектов на территории РФ (*23. Перечень карантинных объектов, Скачать набор в CSV*)
    * Перечень карантинных зон на территории РФ (*24. Перечень карантинных фитосанитарных зон, Скачать набор в CSV*)
    * Данные о количестве обнаруженных очагов карантинных объектов и их местоположении можно получить из скан-копий приказов, ссылки на которые даны в документе *"Карантинные фитосанитарные зоны, установленные на территории Российской Федерации"* в разделе **"Карантинные фитосанитарные зоны"** на странице ["Полезная информация"](https://fsvps.gov.ru/fsvps/usefulinf) ведомства. В данной реализации использована информация от февраля 2021 года.

В данной реализации будут учтены только те карантинные зоны, которые были введены после 2015-го года либо переопределены специальными приказами после 2015-го года.

2. Данные о встречаемости видов из списка растений-карантинных объектов с сайта [Глобальной информационной системы о биоразнообразии](https://www.gbif.org/ru/)

Также для анализа нам понадобятся:
3.  данные о посевных площадях по субъектам РФ с [портала открытых данных Министерства сельского хозяйства](http://opendata.mcx.ru/opendata/7708075454-posevzemlivesna). В данной реализации использованы данные за 2017-й год (наиболее актуальные из доступных на данный момент).

4. данные о границах субъектов РФ в виде файла *geo.json*. Для данного проект geo.json взят с [GitHub](https://github.com/Kreozot/russian-geo-data).

### Запрос данных

Данные с сайта системы о биоразнообразии запрашиваются через [Occurrence API](https://www.gbif.org/developer/occurrence) (вариант запроса **/occurrence/download/request**).
В связи с тем, что в списке растений-карантинных объектов отдельно присутствуют целые рода растений без уточнения видов, запрос через сайт системы о биоразнообразии отправляется дважды:
1. запрос с целью получения списка видов указанных в списке карантинных объектов родов растений (только для РФ, в указанный период времени) 
    * файл *gbif_downl_api_genus.py* для получения файла с перечнем встреченных объектов 
    * затем файл *genus_csv_to_spec_list.py* для получения списка GBIF-кодов встреченных видов
2. запрос с целью получения информации о присутствии растений-карантинных объектов на территории РФ в указанный период времени (дополненный указанием конкретных видов из запроса №1) - файл *gbif_downl_api_species.py*. В качестве информации о видах для большей точного ответа при обоих запросах используются GBIF-коды, а не названия видов.

### Подготовка и приведение данных к единому виду для дальнейшей обработки

Для приведения данных к единой структуре, полученные из запросов файлы с данными проходят следующую обработку:
1. Данные о карантинных зонах:
    * файл с данными о карантинных зонах проходит обработку файлом *herb_csv.py*;
    * записи дат в полученном в результате .json-файле, которые не были распознаны (строка *"Дата не определена для этого приказа!!!"* вместо даты), должны быть отредактирована на основании информации в поле "order";
    * затем скрипт *json_dates_manager.py* удалит из получившегося файла приказы не актуализированные с 2016-го года;
    * в получившемся файле необходимо заполнить поля *"latitude"* и *"longitude"* на основе информации из соответствующих приказов. В данной реализации эта информация собрана в результате анализа скан-копий приказов по ссылкам из документа *"Карантинные фитосанитарные зоны, установленные на территории Российской Федерации"* с сайта ведомства.
    * дополненный в результате анализа приказов файл дополнительно обрабатывается скриптом *json_coordinates_manager_for_rsn.py*, который окончательно стандартизирует данные для загрузки в базу.

2. Данные о встреченных растениях из списка карантинных объектов с сайта GBIF:
    * Файл с данными, полученными в результате запроса *gbif_downl_api_species.py* проходит процедуру приведения к стандартному виду посредством скрипта *gbif_species_csv_to_spec_list.py*. Полученный в результате файл с данными дополняется наименованиями регионов в случае, если в отдельных записях названия регионов не были распознаны.
    * после окончательной корректировки информации о регионе находки, файл с данными обрабатывается скриптом *json_coordinates_manager.py*, который, по аналогии со скриптом *json_coordinates_manager_for_rsn.py*, окончательно стандартизирует данные для загрузки в базу.

3. Данные о посевных площадях подготавливаются для анализа в два этапа:
    * На первом этапе скрипт *regions_list_extractor.py*, принимая на вход geo.json регионов России, создает .csv-файл с id и названиями областей.
    * На втором этапе, в получившийся файл добавляется колонка с данными о посевных площадях в регионах из файла с портала открытых данных  Министерства сельского хозяйства.

### Загрузка данных в базу

Для хранения и дальнейшей работы с данными в данной реализации использована система управления базами данных PostgreSQL и библиотека SQLAlchemy.

Модели базы включают три таблица:
* организация-источник данных, - Россельхознадзор и сайт информационной системы о биоразнообразии.
* вид растения-карантинного объекта
* точка обнаружения вида/ очаг вида-карантинного объекта, опредленный приказом

При этом третья таблица содержит зависимости на две предыдущие, которые сами являются независимыми.
Параметры сессии определены скриптом *db.py*, модели описаны в *db_models.py*, загрузка данных по таблицам осуществлена отделно, сначала данные независимых таблиц, - *db_species_loader.py*, затем файлы с данными, подготовленными на предыдущих этапах, - *db_records_loader.py*.

## Анализ данных

Анализ данных проводится по распределению мест обнаружения растений-карантинных объектов и документально зафиксированных очагах растений-карантинных объектов на карте РФ. Дополнительным параметром для анализа служит количество пахотных земель в регионе обнаружения. 

Карты с нанесенной информацией формируются в виде html-страниц при помощи скриптов *folium_show_map.py* и *folium_show_map_filter.py*. По необходимости на карте размещается информация о всех объектах, либо информация по отдельным родам или видам.

Скрипт использует библиотеку Folium как основное средство отображения.

Дополнительным инструментом для анализа служит скрипт *bar_chart_1.py*, который выстраивает столбиковую диаграмму на основе общего количества зафиксированных Россельхознадзором очагов в регионе и данных по пахотным землям. Скрипт использует инструменты библиотек Matplotlib и Numpy.

В целях уточнения результатов анализа в столбиковую диаграмму включены данные только по регионом со значительным объемом карантинных зон по интересующим нас видам, так как только такое сравнение имеет смысл. Сокращенный список регионов со значимым количеством фитосанитарных зон и общее количество обнаруженных очагов в регионе мы получаем при помощи скрипта *json_csv_main_regions_rsn.py* и дополняем данными о посевных площадях по субъектам РФ с портала открытых данных Министерства сельского хозяйства.

